# Nixpacks Configuration for Railway
# Let Nixpacks auto-detect Python and handle dependency installation

# Install system packages needed for coincurve (Stacks signature verification)
[phases.setup]
aptPkgs = ["automake", "autoconf", "libtool", "pkg-config"]

[phases.build]
# Only collect static files during build phase (database not available yet)
cmds = [
    "python manage.py collectstatic --no-input"
]

[start]
# Run migrations FIRST, then create preset tags, then start Gunicorn
# Migrations and tags run on every deploy to keep database up-to-date
cmd = "python manage.py migrate --no-input && python manage.py create_preset_tags && gunicorn deorganized.wsgi:application --bind 0.0.0.0:$PORT"